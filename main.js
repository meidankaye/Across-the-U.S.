!function(){"use strict";document.querySelector(".places");const e=document.querySelector("#place-template"),t=document.querySelector(".popup_type_edit").querySelector(".popup__form"),s=document.querySelector(".popup_type_add").querySelector(".popup__form"),i=document.querySelector(".profile__edit-button"),r=document.querySelector(".profile__add-button"),n=document.querySelector(".popup__input_type_name"),o=document.querySelector(".popup__input_type_profession"),a={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function l(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function c(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var u=class{constructor(e,t){c(this,"_showInputError",(e=>{const t=this._form.querySelector("#".concat(e.id,"-error"));t.textContent=e.validationMessage,t.classList.add(this._errorClass),e.classList.add(this._inputErrorClass)})),c(this,"_hideInputError",(e=>{const t=this._form.querySelector("#".concat(e.id,"-error"));t.textContent="",t.classList.remove(this._errorClass),e.classList.remove(this._inputErrorClass)})),c(this,"_hasOnlyValidInputs",(()=>this._inputList.every((e=>e.validity.valid)))),c(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e)})),c(this,"_setEventListeners",(()=>{this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector)),this._submitButton=this._form.querySelector(this._submitButtonSelector),this._toggleButton(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButton()}))}))})),c(this,"_toggleButton",(()=>{this._hasOnlyValidInputs()?(this._submitButton.disabled=!1,this._submitButton.classList.remove(this._inactiveButtonClass)):(this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0)})),c(this,"resetFormValidation",(()=>{this._inputList.forEach((e=>{this._hideInputError(e)})),this._toggleButton()})),c(this,"enableValidation",(()=>{this._setEventListeners()})),this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=t}},_=class{constructor(e){this._popupElement=document.querySelector(e),this._handleEscUp=this._handleEscUp.bind(this),this.close=this.close.bind(this)}_handleEscUp(e){e.preventDefault(),"Escape"===e.key&&this.close()}setEventListeners(){this._popupElement.querySelector(".popup__close-button").addEventListener("click",this.close),this._popupElement.addEventListener("mousedown",(e=>{[...e.target.classList].includes("popup")&&this.close()}))}open(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keyup",this._handleEscUp)}close(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keyup",this._handleEscUp)}},h=class extends _{constructor(e,t){super(e),this._popupForm=this._popupElement.querySelector(".popup__form"),this._inputList=Array.from(this._popupForm.querySelectorAll(".popup__input")),this._submitHandler=t}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler(this._getInputValues()),this.close()})),super.setEventListeners()}close(){this._popupForm.reset(),super.close()}};let p;const d=new class{constructor(e){let{baseUrl:t,headers:s}=e;var i,r;r=(e,t)=>fetch(e,t).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))).catch((e=>{console.log("Error: ".concat(e))})),(i="_customFetch")in this?Object.defineProperty(this,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[i]=r,this._baseUrl=t,this._headers=s}getInitialCards(){return this._customFetch("".concat(this._baseUrl,"/cards"),{headers:this._headers})}getUserInfo(){return this._customFetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers})}addCard(e){let{name:t,link:s}=e;return this._customFetch("".concat(this._baseUrl,"/cards"),{headers:this._headers,method:"POST",body:JSON.stringify({name:t,link:s})})}removeCard(e){return this._customFetch("".concat(this._baseUrl,"/cards/").concat(e),{headers:this._headers,method:"DELETE"})}likeCard(e){return this._customFetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:"PUT"})}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"439544b2-326e-4000-bd7d-7d8ec93af705","Content-Type":"application/json"}});function m(t){const s=new class{constructor(e,t,s){let{data:i,handleCardClick:r,handleDeleteCard:n,handleLikeButton:o}=e;l(this,"isLiked",(()=>isLiked=this._likes.some((e=>e._id===this._userId)))),l(this,"handleLikeCard",(e=>{this._likes=e,this._cardElement.querySelector(".place__like-count").textContent=this._likes.length,this._cardElement.querySelector(".place__button").classList.toggle("place__button_active")})),l(this,"removeCard",(()=>this._cardElement.remove())),l(this,"_setEventListeners",(()=>{this._cardElement.querySelector(".place__image").addEventListener("click",(()=>this._handleCardClick(this._name,this._link))),this._cardElement.querySelector(".place__button").addEventListener("click",(()=>this._handleLikeButton(this._id))),this._cardElement.querySelector(".place__trash").addEventListener("click",(()=>this._handleDeleteCard(this._id)))})),l(this,"_getTemplate",(()=>this._cardSelector.content.querySelector(".places__item").cloneNode(!0))),l(this,"getElement",(()=>(this._cardElement=this._getTemplate(),this._setEventListeners(),this._cardElement.querySelector(".place__image").style.backgroundImage="url(".concat(this._link,")"),this._cardElement.querySelector(".place__title").textContent=this._name,this._ownerId!==this._userId&&(this._cardElement.querySelector(".place__trash").style.display="none"),this.isLiked&&this.handleLikeCard(this._likes),this._cardElement))),this._name=i.name,this._link=i.link,this._id=i._id,this._likes=i.likes,this._handleCardClick=r,this._handleDeleteCard=n,this._handleLikeButton=o,this._cardSelector=t,this._userId=s,this._ownerId=i.owner._id}}({data:t,handleCardClick:E,handleLikeButton:e=>{d.likeCard(e).then((e=>{s.handleLikeCard(e.likes),console.log(e.likes)}))},handleDeleteCard:e=>{C.open(),C.setAction((()=>{d.removeCard(e).then((()=>{s.removeCard(),C.close()}))}))}},e,p);return s.getElement()}function E(e,t){b.open(e,t)}Promise.all([d.getInitialCards(),d.getUserInfo()]).then((e=>{let[t,s]=e;p=s._id,v.render(t),y.setUserInfo({name:s.name,profession:s.about})}));const v=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}render(e){this._items=e,this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({renderer:e=>{v.addItem(m(e))}},".places"),y=new class{constructor(e){let{nameSelector:t,professionSelector:s}=e;this._userName=document.querySelector(t),this._userProfession=document.querySelector(s)}getUserInfo(){return{name:this._userName.textContent,profession:this._userProfession.textContent}}setUserInfo(e){let{name:t,profession:s}=e;this._userName.textContent=t,this._userProfession.textContent=s}}({nameSelector:".profile__name",professionSelector:".profile__profession"}),b=new class extends _{open(e,t){this._title=this._popupElement.querySelector(".popup__image-name"),this._image=this._popupElement.querySelector(".popup__image-preview"),this._title.textContent=e,this._image.src=t,this._image.alt="Image of ".concat(e),super.open()}}(".popup_type_preview");b.setEventListeners();const f=new h(".popup_type_edit",(function(e){y.setUserInfo(e)}));f.setEventListeners();const L=new h(".popup_type_add",(function(){const e=L._getInputValues(),t={name:e.title,link:e.link};d.addCard(t).then((e=>{m(e)}))}));L.setEventListeners();const C=new class extends _{setAction(e){this._submitHandler=e}setEventListeners(){this._popupElement.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler()})),super.setEventListeners()}}(".popup_type_confirm");C.setEventListeners();const S=new u(a,t),k=new u(a,s);S.enableValidation(),k.enableValidation(),i.addEventListener("click",(()=>{const e=y.getUserInfo();f.open(),n.value=e.name,o.value=e.profession,S.resetFormValidation()})),r.addEventListener("click",(()=>{k.resetFormValidation(),L.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R3JCLGNBQW9DM0UsRUFFaEM0RSxVQUFVbUMsR0FDTjFKLEtBQUsrQyxlQUFpQjJHLEVBRzFCcEgsb0JBQ0l0QyxLQUFLK0IsY0FBY1AsaUJBQWlCLFVBQVdXLElBQzNDQSxFQUFFQyxpQkFDRnBDLEtBQUsrQyxvQkFJVEYsTUFBTVAsc0JOb0ZpQyx1QkFFL0NnRixFQUFhaEYsb0JBRWIsTUFBTXFILEVBQW9CLElBQUlDLEVBQWN2SyxFQUFvQk4sR0FDMUQ4SyxFQUFtQixJQUFJRCxFQUFjdkssRUFBb0JMLEdBRS9EMkssRUFBa0JHLG1CQUNsQkQsRUFBaUJDLG1CQUlqQjdLLEVBQVF1QyxpQkFBaUIsU0FBUyxLQUM5QixNQUFNK0QsRUFBT3dDLEVBQVNwRCxjQUN0QjJFLEVBQVU3RyxPQUNWdEQsRUFBZWlFLE1BQVFtQyxFQUFLcEMsS0FDNUIvRCxFQUFxQmdFLE1BQVFtQyxFQUFLMEMsV0FDbEMwQixFQUFrQkkseUJBSXRCN0ssRUFBT3NDLGlCQUFpQixTQUFTLEtBQzdCcUksRUFBaUJFLHNCQUNqQlAsRUFBUy9HLFUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mb3VydGgtcHJvamVjdC8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vZm91cnRoLXByb2plY3QvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL2ZvdXJ0aC1wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vZm91cnRoLXByb2plY3QvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL2ZvdXJ0aC1wcm9qZWN0Ly4vc3JjL3BhZ2UvaW5kZXguanMiLCJ3ZWJwYWNrOi8vZm91cnRoLXByb2plY3QvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vZm91cnRoLXByb2plY3QvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL2ZvdXJ0aC1wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9mb3VydGgtcHJvamVjdC8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL2ZvdXJ0aC1wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vZm91cnRoLXByb2plY3QvLi9zcmMvY29tcG9uZW50cy9Qb3VwV2l0aENvbmZpbWF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBwbGFjZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlc1wiKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGxhY2UtdGVtcGxhdGVcIik7XHJcblxyXG5leHBvcnQgY29uc3QgZWRpdEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX3R5cGVfZWRpdFwiKS5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xyXG5leHBvcnQgY29uc3QgYWRkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfdHlwZV9hZGRcIikucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcclxuXHJcbmV4cG9ydCBjb25zdCBlZGl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcclxuZXhwb3J0IGNvbnN0IGFkZEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcclxuXHJcbmV4cG9ydCBjb25zdCBwb3B1cElucHV0TmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2lucHV0X3R5cGVfbmFtZVwiKTtcclxuZXhwb3J0IGNvbnN0IHBvcHVwSW5wdXRQcm9mZXNzaW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW5wdXRfdHlwZV9wcm9mZXNzaW9uXCIpO1xyXG5cclxuZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25TZXR0aW5ncyA9IHtcclxuICAgIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pbnB1dFwiLFxyXG4gICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLnBvcHVwX19idXR0b25cIixcclxuICAgIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwicG9wdXBfX2J1dHRvbl9kaXNhYmxlZFwiLFxyXG4gICAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgICBlcnJvckNsYXNzOiBcInBvcHVwX19lcnJvcl92aXNpYmxlXCJcclxufTsiLCJjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybUVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gc2V0dGluZ3MuaW5wdXRTZWxlY3RvcjtcclxuICAgICAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yO1xyXG4gICAgICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzO1xyXG4gICAgICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcztcclxuICAgICAgICB0aGlzLl9lcnJvckNsYXNzID0gc2V0dGluZ3MuZXJyb3JDbGFzcztcclxuXHJcbiAgICAgICAgdGhpcy5fZm9ybSA9IGZvcm1FbGVtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIF9zaG93SW5wdXRFcnJvciA9IChpbnB1dEVsKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG4gICAgICAgIGVycm9yTWVzc2FnZS50ZXh0Q29udGVudCA9IGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2U7XHJcbiAgICAgICAgZXJyb3JNZXNzYWdlLmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgICAgICAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICB9XHJcblxyXG4gICAgX2hpZGVJbnB1dEVycm9yID0gKGlucHV0RWwpID0+IHtcclxuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XHJcbiAgICAgICAgZXJyb3JNZXNzYWdlLnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgICAgICBlcnJvck1lc3NhZ2UuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcclxuICAgICAgICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcclxuICAgIH1cclxuXHJcbiAgICBfaGFzT25seVZhbGlkSW5wdXRzID0gKCkgPT4gdGhpcy5faW5wdXRMaXN0LmV2ZXJ5KChpbnB1dEVsKSA9PiBpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcclxuXHJcblxyXG4gICAgX2NoZWNrSW5wdXRWYWxpZGl0eSA9IChpbnB1dEVsKSA9PiB7XHJcbiAgICAgICAgaWYgKGlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5faW5wdXRTZWxlY3RvcikpO1xyXG4gICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uKCk7XHJcbiAgICBcclxuICAgICAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xyXG4gICAgICAgICAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90b2dnbGVCdXR0b24oKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgX3RvZ2dsZUJ1dHRvbiA9ICgpID0+IHtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX2hhc09ubHlWYWxpZElucHV0cygpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXRGb3JtVmFsaWRhdGlvbiA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaChpbnB1dEVsID0+IHtcclxuICAgICAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbCk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZW5hYmxlVmFsaWRhdGlvbiA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG4gICAgXHJcbn1cclxuXHJcblxyXG5leHBvcnQgZGVmYXVsdCBGb3JtVmFsaWRhdG9yOyIsImNsYXNzIFBvcHVwIHtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl9oYW5kbGVFc2NVcCA9IHRoaXMuX2hhbmRsZUVzY1VwLmJpbmQodGhpcyk7XHJcbiAgICAgICAgdGhpcy5jbG9zZSA9IHRoaXMuY2xvc2UuYmluZCh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBfaGFuZGxlRXNjVXAoZSkge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Nsb3NlLWJ1dHRvblwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5jbG9zZSk7XHJcblxyXG4gICAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChbLi4uZS50YXJnZXQuY2xhc3NMaXN0XS5pbmNsdWRlcyhcInBvcHVwXCIpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgb3BlbigpIHtcclxuICAgICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5faGFuZGxlRXNjVXApO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLl9oYW5kbGVFc2NVcCk7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBQb3B1cDsiLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XHJcblxyXG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvciwgc3VibWl0SGFuZGxlcikge1xyXG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG5cclxuICAgICAgICB0aGlzLl9wb3B1cEZvcm0gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcclxuICAgICAgICB0aGlzLl9pbnB1dExpc3QgPSBBcnJheS5mcm9tKHRoaXMuX3BvcHVwRm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19pbnB1dFwiKSk7XHJcbiAgICAgICAgdGhpcy5fc3VibWl0SGFuZGxlciA9IHN1Ym1pdEhhbmRsZXI7XHJcbiAgICB9XHJcblxyXG4gICAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XHJcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICAgICAgICAgIGlucHV0VmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBpbnB1dFZhbHVlcztcclxuICAgIH1cclxuXHJcbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICB0aGlzLl9wb3B1cEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3N1Ym1pdEhhbmRsZXIodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwRm9ybS5yZXNldCgpO1xyXG5cclxuICAgICAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUG9wdXBXaXRoRm9ybTsiLCJpbXBvcnQgXCJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWVcIjtcclxuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcclxuXHJcbmltcG9ydCB7IGNhcmRUZW1wbGF0ZSwgZWRpdEZvcm0sIGFkZEZvcm0sIGVkaXRCdG4sIGFkZEJ0biwgcG9wdXBJbnB1dE5hbWUsIHBvcHVwSW5wdXRQcm9mZXNzaW9uLCB2YWxpZGF0aW9uU2V0dGluZ3MgfSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcclxuaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhDb25maXJtYXRpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG91cFdpdGhDb25maW1hdGlvbi5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcclxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vY29tcG9uZW50cy9BcGkuanNcIjtcclxuXHJcbmxldCB1c2VySWQ7XHJcblxyXG4vLyBBUElcclxuXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gICAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTEyXCIsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgYXV0aG9yaXphdGlvbjogXCI0Mzk1NDRiMi0zMjZlLTQwMDAtYmQ3ZC03ZDhlYzkzYWY3MDVcIixcclxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgIH0sXHJcbn0pO1xyXG5cclxuXHJcblByb21pc2UuYWxsKFthcGkuZ2V0SW5pdGlhbENhcmRzKCksIGFwaS5nZXRVc2VySW5mbygpXSlcclxuICAgIC50aGVuKChbY2FyZHMsIHVzZXJEYXRhXSkgPT4ge1xyXG4gICAgICAgIHVzZXJJZCA9IHVzZXJEYXRhLl9pZDtcclxuICAgICAgICBzZWN0aW9uLnJlbmRlcihjYXJkcyk7XHJcblxyXG4gICAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHsgbmFtZTogdXNlckRhdGEubmFtZSwgcHJvZmVzc2lvbjogdXNlckRhdGEuYWJvdXQgfSlcclxuICAgIH0pXHJcblxyXG4vLyBGdW5jdGlvbnNcclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUNhcmQoZGF0YSkge1xyXG4gICAgY29uc3QgbmV3Q2FyZCA9IG5ldyBDYXJkKHtcclxuICAgICAgICBkYXRhLFxyXG4gICAgICAgIGhhbmRsZUNhcmRDbGljayxcclxuICAgICAgICBoYW5kbGVMaWtlQnV0dG9uOiAoaWQpID0+IHtcclxuICAgICAgICAgICAgYXBpLmxpa2VDYXJkKGlkKS50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgICAgIG5ld0NhcmQuaGFuZGxlTGlrZUNhcmQocmVzLmxpa2VzKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcy5saWtlcyk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSwgXHJcbiAgICAgICAgaGFuZGxlRGVsZXRlQ2FyZDogKGlkKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbmZpcm1Qb3B1cC5vcGVuKCk7XHJcbiAgICAgICAgICAgIGNvbmZpcm1Qb3B1cC5zZXRBY3Rpb24oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYXBpLnJlbW92ZUNhcmQoaWQpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld0NhcmQucmVtb3ZlQ2FyZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1Qb3B1cC5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9LCBjYXJkVGVtcGxhdGUsIHVzZXJJZClcclxuXHJcbiAgICByZXR1cm4gbmV3Q2FyZC5nZXRFbGVtZW50KCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUNhcmRDbGljayAobmFtZSwgbGluaykge1xyXG4gICAgaW1hZ2VQb3B1cC5vcGVuKG5hbWUsIGxpbmspO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVBZGRGb3JtU3VibWl0KCkge1xyXG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSBhZGRQb3B1cC5fZ2V0SW5wdXRWYWx1ZXMoKTtcclxuICAgIGNvbnN0IGRhdGEgPSB7IG5hbWU6IGlucHV0VmFsdWVzLnRpdGxlLCBsaW5rOiBpbnB1dFZhbHVlcy5saW5rIH07XHJcbiAgICBhcGkuYWRkQ2FyZChkYXRhKS50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgY3JlYXRlQ2FyZChyZXMpO1xyXG4gICAgfSlcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRWRpdEZvcm1TdWJtaXQoZGF0YSkge1xyXG4gICAgdXNlckluZm8uc2V0VXNlckluZm8oZGF0YSlcclxufVxyXG5cclxuLy8gQ2xhc3Nlc1xyXG5jb25zdCBzZWN0aW9uID0gbmV3IFNlY3Rpb24oe1xyXG4gICAgcmVuZGVyZXI6IChjYXJkKSA9PiB7XHJcbiAgICAgICAgc2VjdGlvbi5hZGRJdGVtKGNyZWF0ZUNhcmQoY2FyZCkpO1xyXG4gICAgfVxyXG59LCBcIi5wbGFjZXNcIik7XHJcblxyXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XHJcbiAgICBuYW1lU2VsZWN0b3I6IFwiLnByb2ZpbGVfX25hbWVcIixcclxuICAgIHByb2Zlc3Npb25TZWxlY3RvcjogXCIucHJvZmlsZV9fcHJvZmVzc2lvblwiXHJcbn0pO1xyXG5cclxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIi5wb3B1cF90eXBlX3ByZXZpZXdcIik7XHJcbmltYWdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmNvbnN0IGVkaXRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLnBvcHVwX3R5cGVfZWRpdFwiLCBoYW5kbGVFZGl0Rm9ybVN1Ym1pdCk7XHJcblxyXG5lZGl0UG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmNvbnN0IGFkZFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXBfdHlwZV9hZGRcIiwgaGFuZGxlQWRkRm9ybVN1Ym1pdCk7XHJcblxyXG5hZGRQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuY29uc3QgY29uZmlybVBvcHVwID0gbmV3IFBvcHVwV2l0aENvbmZpcm1hdGlvbihcIi5wb3B1cF90eXBlX2NvbmZpcm1cIik7XHJcblxyXG5jb25maXJtUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmNvbnN0IGVkaXRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IodmFsaWRhdGlvblNldHRpbmdzLCBlZGl0Rm9ybSk7XHJcbmNvbnN0IGFkZEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcih2YWxpZGF0aW9uU2V0dGluZ3MsIGFkZEZvcm0pO1xyXG5cclxuZWRpdEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5hZGRGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuXHJcbi8vRXZlbnQgTGlzdGVuZXJzXHJcblxyXG5lZGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICBjb25zdCBkYXRhID0gdXNlckluZm8uZ2V0VXNlckluZm8oKVxyXG4gICAgZWRpdFBvcHVwLm9wZW4oKTtcclxuICAgIHBvcHVwSW5wdXROYW1lLnZhbHVlID0gZGF0YS5uYW1lO1xyXG4gICAgcG9wdXBJbnB1dFByb2Zlc3Npb24udmFsdWUgPSBkYXRhLnByb2Zlc3Npb247XHJcbiAgICBlZGl0Rm9ybVZhbGlkYXRvci5yZXNldEZvcm1WYWxpZGF0aW9uKCk7XHJcbn0pO1xyXG5cclxuXHJcbmFkZEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgYWRkRm9ybVZhbGlkYXRvci5yZXNldEZvcm1WYWxpZGF0aW9uKCk7XHJcbiAgICBhZGRQb3B1cC5vcGVuKCk7XHJcbn0pOyIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XHJcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcclxuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xyXG4gIH1cclxuXHJcbiAgX2N1c3RvbUZldGNoID0gKHVybCwgaGVhZGVycykgPT4ge1xyXG4gICAgcmV0dXJuIGZldGNoKHVybCwgaGVhZGVycylcclxuICAgICAgLnRoZW4oKHJlcykgPT5cclxuICAgICAgICByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YClcclxuICAgICAgKVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBFcnJvcjogJHtlcnJ9YCk7XHJcbiAgICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGdldEluaXRpYWxDYXJkcygpIHtcclxuICAgIHJldHVybiB0aGlzLl9jdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcclxuICAgIHJldHVybiB0aGlzLl9jdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgbmFtZSxcclxuICAgICAgICAgbGluayBcclxuICAgICAgfSlcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlQ2FyZChjYXJkSUQpIHtcclxuICAgIHJldHVybiB0aGlzLl9jdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJRH1gLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGxpa2VDYXJkKGNhcmRJRCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElEfWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn0iLCJjbGFzcyBDYXJkIHtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih7IGRhdGEsIGhhbmRsZUNhcmRDbGljaywgaGFuZGxlRGVsZXRlQ2FyZCwgaGFuZGxlTGlrZUJ1dHRvbiB9LCBjYXJkU2VsZWN0b3IsIHVzZXJJZCkge1xyXG4gICAgICAgIHRoaXMuX25hbWUgPSBkYXRhLm5hbWU7XHJcbiAgICAgICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcclxuXHJcbiAgICAgICAgdGhpcy5faWQgPSBkYXRhLl9pZDtcclxuICAgICAgICB0aGlzLl9saWtlcyA9IGRhdGEubGlrZXM7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrID0gaGFuZGxlQ2FyZENsaWNrO1xyXG4gICAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNhcmQgPSBoYW5kbGVEZWxldGVDYXJkO1xyXG4gICAgICAgIHRoaXMuX2hhbmRsZUxpa2VCdXR0b24gPSBoYW5kbGVMaWtlQnV0dG9uO1xyXG5cclxuICAgICAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XHJcbiAgICAgICAgdGhpcy5fdXNlcklkID0gdXNlcklkO1xyXG4gICAgICAgIHRoaXMuX293bmVySWQgPSBkYXRhLm93bmVyLl9pZDtcclxuICAgIH1cclxuXHJcbiAgICBpc0xpa2VkID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBpc0xpa2VkID0gdGhpcy5fbGlrZXMuc29tZSgocGVyc29uKSA9PiBwZXJzb24uX2lkID09PSB0aGlzLl91c2VySWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGhhbmRsZUxpa2VDYXJkID0gKGxpa2VzKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fbGlrZXMgPSBsaWtlcztcclxuICAgICAgICB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlX19saWtlLWNvdW50XCIpLnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xyXG4gICAgICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VfX2J1dHRvblwiKS5jbGFzc0xpc3QudG9nZ2xlKFwicGxhY2VfX2J1dHRvbl9hY3RpdmVcIik7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJlbW92ZUNhcmQgPSAoKSA9PiB0aGlzLl9jYXJkRWxlbWVudC5yZW1vdmUoKTtcclxuXHJcbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZV9faW1hZ2VcIilcclxuICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX2hhbmRsZUNhcmRDbGljayh0aGlzLl9uYW1lLCB0aGlzLl9saW5rKSk7XHJcblxyXG4gICAgICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VfX2J1dHRvblwiKVxyXG4gICAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5faGFuZGxlTGlrZUJ1dHRvbih0aGlzLl9pZCkpO1xyXG5cclxuICAgICAgICB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlX190cmFzaFwiKVxyXG4gICAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCh0aGlzLl9pZCkpO1xyXG4gICAgfVxyXG5cclxuICAgIF9nZXRUZW1wbGF0ZSA9ICgpID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY2FyZFNlbGVjdG9yXHJcbiAgICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2l0ZW1cIilcclxuICAgICAgICAuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEVsZW1lbnQgPSAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fY2FyZEVsZW1lbnQgPSB0aGlzLl9nZXRUZW1wbGF0ZSgpO1xyXG4gICAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4gICAgICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VfX2ltYWdlXCIpXHJcbiAgICAgICAgLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGB1cmwoJHt0aGlzLl9saW5rfSlgO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VfX3RpdGxlXCIpLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX293bmVySWQgIT09IHRoaXMuX3VzZXJJZCkge1xyXG4gICAgICAgICAgICB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlX190cmFzaFwiKS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pc0xpa2VkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlTGlrZUNhcmQodGhpcy5fbGlrZXMpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5fY2FyZEVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBDYXJkOyIsImNsYXNzIFNlY3Rpb24ge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHsgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcclxuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlcihpdGVtcykge1xyXG4gICAgICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XHJcbiAgICAgICAgdGhpcy5faXRlbXMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIoaXRlbSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkSXRlbShlbGVtZW50KSB7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoZWxlbWVudCk7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBTZWN0aW9uOyIsIi8vIFdvcmsgaW4gUHJvZ3Jlc3NcclxuXHJcbmNsYXNzIFVzZXJJbmZvIHtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih7IG5hbWVTZWxlY3RvciwgcHJvZmVzc2lvblNlbGVjdG9yIH0pIHtcclxuICAgICAgICB0aGlzLl91c2VyTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobmFtZVNlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl91c2VyUHJvZmVzc2lvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocHJvZmVzc2lvblNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRVc2VySW5mbygpIHtcclxuICAgICAgICByZXR1cm4geyBcclxuICAgICAgICAgICAgbmFtZTogdGhpcy5fdXNlck5hbWUudGV4dENvbnRlbnQsXHJcbiAgICAgICAgICAgIHByb2Zlc3Npb246IHRoaXMuX3VzZXJQcm9mZXNzaW9uLnRleHRDb250ZW50IFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VXNlckluZm8oeyBuYW1lLCBwcm9mZXNzaW9uIH0pIHtcclxuICAgICAgICB0aGlzLl91c2VyTmFtZS50ZXh0Q29udGVudCA9IG5hbWVcclxuICAgICAgICB0aGlzLl91c2VyUHJvZmVzc2lvbi50ZXh0Q29udGVudCA9IHByb2Zlc3Npb25cclxuICAgIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFVzZXJJbmZvOyIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XHJcblxyXG4gICAgb3BlbihuYW1lLCBsaW5rKSB7XHJcbiAgICAgICAgdGhpcy5fdGl0bGUgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2UtbmFtZVwiKTtcclxuICAgICAgICB0aGlzLl9pbWFnZSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWFnZS1wcmV2aWV3XCIpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuX3RpdGxlLnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgICAgICB0aGlzLl9pbWFnZS5zcmMgPSBsaW5rO1xyXG4gICAgICAgIHRoaXMuX2ltYWdlLmFsdCA9IGBJbWFnZSBvZiAke25hbWV9YFxyXG4gICAgICAgIHN1cGVyLm9wZW4oKTtcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFBvcHVwV2l0aEltYWdlOyIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuY2xhc3MgUG9wdXBXaXRoQ29uZmlybWF0aW9uIGV4dGVuZHMgUG9wdXAge1xyXG5cclxuICAgIHNldEFjdGlvbihhY3Rpb24pIHtcclxuICAgICAgICB0aGlzLl9zdWJtaXRIYW5kbGVyID0gYWN0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdGhpcy5fc3VibWl0SGFuZGxlcigpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFBvcHVwV2l0aENvbmZpcm1hdGlvbjsiXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY2FyZFRlbXBsYXRlIiwiZWRpdEZvcm0iLCJhZGRGb3JtIiwiZWRpdEJ0biIsImFkZEJ0biIsInBvcHVwSW5wdXROYW1lIiwicG9wdXBJbnB1dFByb2Zlc3Npb24iLCJ2YWxpZGF0aW9uU2V0dGluZ3MiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImNvbnN0cnVjdG9yIiwic2V0dGluZ3MiLCJmb3JtRWxlbWVudCIsImlucHV0RWwiLCJlcnJvck1lc3NhZ2UiLCJ0aGlzIiwiX2Zvcm0iLCJpZCIsInRleHRDb250ZW50IiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJjbGFzc0xpc3QiLCJhZGQiLCJfZXJyb3JDbGFzcyIsIl9pbnB1dEVycm9yQ2xhc3MiLCJyZW1vdmUiLCJfaW5wdXRMaXN0IiwiZXZlcnkiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hpZGVJbnB1dEVycm9yIiwiX3Nob3dJbnB1dEVycm9yIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsIl9pbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvbiIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsIl90b2dnbGVCdXR0b24iLCJmb3JFYWNoIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJfaGFzT25seVZhbGlkSW5wdXRzIiwiZGlzYWJsZWQiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsIl9zZXRFdmVudExpc3RlbmVycyIsInBvcHVwU2VsZWN0b3IiLCJfcG9wdXBFbGVtZW50IiwiX2hhbmRsZUVzY1VwIiwiYmluZCIsImNsb3NlIiwiZSIsInByZXZlbnREZWZhdWx0Iiwia2V5Iiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJ0YXJnZXQiLCJpbmNsdWRlcyIsIm9wZW4iLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiUG9wdXAiLCJzdWJtaXRIYW5kbGVyIiwic3VwZXIiLCJfcG9wdXBGb3JtIiwiX3N1Ym1pdEhhbmRsZXIiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJpbnB1dFZhbHVlcyIsImlucHV0IiwibmFtZSIsInZhbHVlIiwicmVzZXQiLCJ1c2VySWQiLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsInVybCIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0SW5pdGlhbENhcmRzIiwiX2N1c3RvbUZldGNoIiwiZ2V0VXNlckluZm8iLCJhZGRDYXJkIiwibGluayIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwicmVtb3ZlQ2FyZCIsImNhcmRJRCIsImxpa2VDYXJkIiwiYXV0aG9yaXphdGlvbiIsImNyZWF0ZUNhcmQiLCJkYXRhIiwibmV3Q2FyZCIsImNhcmRTZWxlY3RvciIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZURlbGV0ZUNhcmQiLCJoYW5kbGVMaWtlQnV0dG9uIiwiaXNMaWtlZCIsIl9saWtlcyIsInNvbWUiLCJwZXJzb24iLCJfaWQiLCJfdXNlcklkIiwibGlrZXMiLCJfY2FyZEVsZW1lbnQiLCJsZW5ndGgiLCJ0b2dnbGUiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX25hbWUiLCJfbGluayIsIl9oYW5kbGVMaWtlQnV0dG9uIiwiX2hhbmRsZURlbGV0ZUNhcmQiLCJfY2FyZFNlbGVjdG9yIiwiY29udGVudCIsImNsb25lTm9kZSIsIl9nZXRUZW1wbGF0ZSIsInN0eWxlIiwiYmFja2dyb3VuZEltYWdlIiwiX293bmVySWQiLCJkaXNwbGF5IiwiaGFuZGxlTGlrZUNhcmQiLCJvd25lciIsImNvbmZpcm1Qb3B1cCIsInNldEFjdGlvbiIsImdldEVsZW1lbnQiLCJpbWFnZVBvcHVwIiwiYWxsIiwiY2FyZHMiLCJ1c2VyRGF0YSIsInNlY3Rpb24iLCJyZW5kZXIiLCJ1c2VySW5mbyIsInNldFVzZXJJbmZvIiwicHJvZmVzc2lvbiIsImFib3V0IiwiY29udGFpbmVyU2VsZWN0b3IiLCJyZW5kZXJlciIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJpdGVtcyIsIl9pdGVtcyIsIml0ZW0iLCJhZGRJdGVtIiwiZWxlbWVudCIsInByZXBlbmQiLCJjYXJkIiwibmFtZVNlbGVjdG9yIiwicHJvZmVzc2lvblNlbGVjdG9yIiwiX3VzZXJOYW1lIiwiX3VzZXJQcm9mZXNzaW9uIiwiX3RpdGxlIiwiX2ltYWdlIiwic3JjIiwiYWx0IiwiZWRpdFBvcHVwIiwiUG9wdXBXaXRoRm9ybSIsImFkZFBvcHVwIiwidGl0bGUiLCJhY3Rpb24iLCJlZGl0Rm9ybVZhbGlkYXRvciIsIkZvcm1WYWxpZGF0b3IiLCJhZGRGb3JtVmFsaWRhdG9yIiwiZW5hYmxlVmFsaWRhdGlvbiIsInJlc2V0Rm9ybVZhbGlkYXRpb24iXSwic291cmNlUm9vdCI6IiJ9