!function(){"use strict";document.querySelector(".places");const e=document.querySelector("#place-template"),t=document.querySelector(".popup_type_edit").querySelector(".popup__form"),s=document.querySelector(".popup_type_add").querySelector(".popup__form"),r=document.querySelector(".profile__edit-button"),i=document.querySelector(".profile__add-button"),n=document.querySelector(".popup__input_type_name"),o=document.querySelector(".popup__input_type_profession"),a={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function l(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function c(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var u=class{constructor(e,t){c(this,"_showInputError",(e=>{const t=this._form.querySelector("#".concat(e.id,"-error"));t.textContent=e.validationMessage,t.classList.add(this._errorClass),e.classList.add(this._inputErrorClass)})),c(this,"_hideInputError",(e=>{const t=this._form.querySelector("#".concat(e.id,"-error"));t.textContent="",t.classList.remove(this._errorClass),e.classList.remove(this._inputErrorClass)})),c(this,"_hasOnlyValidInputs",(()=>this._inputList.every((e=>e.validity.valid)))),c(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e)})),c(this,"_setEventListeners",(()=>{this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector)),this._submitButton=this._form.querySelector(this._submitButtonSelector),this._toggleButton(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButton()}))}))})),c(this,"_toggleButton",(()=>{this._hasOnlyValidInputs()?(this._submitButton.disabled=!1,this._submitButton.classList.remove(this._inactiveButtonClass)):(this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0)})),c(this,"resetFormValidation",(()=>{this._inputList.forEach((e=>{this._hideInputError(e)})),this._toggleButton()})),c(this,"enableValidation",(()=>{this._setEventListeners()})),this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=t}},h=class{constructor(e){this._popupElement=document.querySelector(e),this._handleEscUp=this._handleEscUp.bind(this),this.close=this.close.bind(this)}_handleEscUp(e){e.preventDefault(),"Escape"===e.key&&this.close()}setEventListeners(){this._popupElement.querySelector(".popup__close-button").addEventListener("click",this.close),this._popupElement.addEventListener("mousedown",(e=>{[...e.target.classList].includes("popup")&&this.close()}))}open(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keyup",this._handleEscUp)}close(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keyup",this._handleEscUp)}},_=class extends h{constructor(e,t,s){super(e),this._popupForm=this._popupElement.querySelector(".popup__form"),this._button=this._popupForm.querySelector(".popup__button"),this._inputList=Array.from(this._popupForm.querySelectorAll(".popup__input")),this._buttonText=s,this._submitHandler=t}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}close(){this._popupForm.reset(),super.close()}showLoading(){this._button.textContent="Saving..."}setEventListeners(){this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler(this._getInputValues()),this.close()})),super.setEventListeners()}};let d;const p=new class{constructor(e){let{baseUrl:t,headers:s}=e;var r,i;i=(e,t)=>fetch(e,t).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))).catch((e=>{console.log("Error: ".concat(e))})),(r="_customFetch")in this?Object.defineProperty(this,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[r]=i,this._baseUrl=t,this._headers=s}getInitialCards(){return this._customFetch("".concat(this._baseUrl,"/cards"),{headers:this._headers})}getUserInfo(){return this._customFetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers})}updateUserImage(e){let{avatar:t}=e;return this._customFetch("".concat(this._baseUrl,"/users/me/avatar"),{headers:this._headers,method:"PATCH",body:JSON.stringify({avatar:t})})}addCard(e){let{name:t,link:s}=e;return this._customFetch("".concat(this._baseUrl,"/cards"),{headers:this._headers,method:"POST",body:JSON.stringify({name:t,link:s})})}removeCard(e){return this._customFetch("".concat(this._baseUrl,"/cards/").concat(e),{headers:this._headers,method:"DELETE"})}likeCard(e){return this._customFetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:"PUT"})}dislikeCard(e){return this._customFetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:"DELETE"})}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"439544b2-326e-4000-bd7d-7d8ec93af705","Content-Type":"application/json"}});function m(t){const s=new class{constructor(e,t,s){let{data:r,handleCardClick:i,handleDeleteCard:n,handleLikeButton:o}=e;l(this,"handleLikeCard",(e=>{this._likes=e,this._cardElement.querySelector(".place__like-count").textContent=this._likes.length,this._cardElement.querySelector(".place__button").classList.toggle("place__button_active")})),l(this,"removeCard",(()=>this._cardElement.remove())),l(this,"_setEventListeners",(()=>{this._cardElement.querySelector(".place__image").addEventListener("click",(()=>this._handleCardClick(this._name,this._link))),this._cardElement.querySelector(".place__button").addEventListener("click",(()=>this._handleLikeButton(this._id))),this._cardElement.querySelector(".place__trash").addEventListener("click",(()=>this._handleDeleteCard(this._id)))})),l(this,"_getTemplate",(()=>this._cardSelector.content.querySelector(".places__item").cloneNode(!0))),l(this,"getElement",(()=>(this._cardElement=this._getTemplate(),this._setEventListeners(),this._cardElement.querySelector(".place__image").style.backgroundImage="url(".concat(this._link,")"),this._cardElement.querySelector(".place__title").textContent=this._name,this._ownerId!==this._userId&&(this._cardElement.querySelector(".place__trash").style.display="none"),this._cardElement.querySelector(".place__like-count").textContent=this._likes.length,this.isLiked()&&this.handleLikeCard(this._likes),this._cardElement))),this._name=r.name,this._link=r.link,this._id=r._id,this._likes=r.likes,this._handleCardClick=i,this._handleDeleteCard=n,this._handleLikeButton=o,this._cardSelector=t,this._userId=s,this._ownerId=r.owner._id}isLiked(){return this._likes.some((e=>e._id===this._userId))}}({data:t,handleCardClick:E,handleLikeButton:e=>{s.isLiked()?p.dislikeCard(e).then((e=>{s.handleLikeCard(e.likes)})):p.likeCard(e).then((e=>{s.handleLikeCard(e.likes)}))},handleDeleteCard:e=>{S.open(),S.setAction((()=>{p.removeCard(e).then((()=>{s.removeCard(),S.close()}))}))}},e,d);return s.getElement()}function E(e,t){b.open(e,t)}Promise.all([p.getInitialCards(),p.getUserInfo()]).then((e=>{let[t,s]=e;d=s._id,y.render(t),v.setUserInfo({name:s.name,profession:s.about})}));const y=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}render(e){this._items=e,this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({renderer:e=>{y.addItem(m(e))}},".places"),v=new class{constructor(e){let{nameSelector:t,professionSelector:s,imageSelector:r}=e;this._userName=document.querySelector(t),this._userProfession=document.querySelector(s),this._userImage=document.querySelector(r)}getUserInfo(){return{name:this._userName.textContent,profession:this._userProfession.textContent}}setUserInfo(e){let{name:t,profession:s}=e;this._userName.textContent=t,this._userProfession.textContent=s}setUserImage(e){this._userImage.style.backgroundImage='url("'.concat(e,'")')}}({nameSelector:".profile__name",professionSelector:".profile__profession",imageSelector:".profile__image"}),b=new class extends h{open(e,t){this._title=this._popupElement.querySelector(".popup__image-name"),this._image=this._popupElement.querySelector(".popup__image-preview"),this._title.textContent=e,this._image.src=t,this._image.alt="Image of ".concat(e),super.open()}}(".popup_type_preview");b.setEventListeners();const f=new _(".popup_type_edit",(function(e){v.setUserInfo(e)}),"Save");f.setEventListeners();const C=new _(".popup_type_add",(function(){const e=C._getInputValues(),t={name:e.title,link:e.link};p.addCard(t).then((e=>{m(e)}))}),"Create");C.setEventListeners();const S=new class extends h{constructor(){}setAction(e){this._submitHandler=e}setEventListeners(){this._popupElement.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler()})),super.setEventListeners()}}(".popup_type_confirm");S.setEventListeners();const g=new u(a,t),L=new u(a,s);g.enableValidation(),L.enableValidation(),r.addEventListener("click",(()=>{const e=v.getUserInfo();f.open(),n.value=e.name,o.value=e.profession,g.resetFormValidation()})),i.addEventListener("click",(()=>{L.resetFormValidation(),C.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixNQUFNc0UsRUFBT3lDLEVBQVN4RCxjQUN0QmtGLEVBQVV4SCxPQUNWdEQsRUFBZW9FLE1BQVF1QyxFQUFLeEMsS0FDNUJsRSxFQUFxQm1FLE1BQVF1QyxFQUFLMkMsV0FDbEM2QixFQUFrQkkseUJBSXRCeEwsRUFBT3NDLGlCQUFpQixTQUFTLEtBQzdCZ0osRUFBaUJFLHNCQUNqQlAsRUFBUzFILFUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mb3VydGgtcHJvamVjdC8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vZm91cnRoLXByb2plY3QvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL2ZvdXJ0aC1wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vZm91cnRoLXByb2plY3QvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL2ZvdXJ0aC1wcm9qZWN0Ly4vc3JjL3BhZ2UvaW5kZXguanMiLCJ3ZWJwYWNrOi8vZm91cnRoLXByb2plY3QvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vZm91cnRoLXByb2plY3QvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL2ZvdXJ0aC1wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9mb3VydGgtcHJvamVjdC8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL2ZvdXJ0aC1wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vZm91cnRoLXByb2plY3QvLi9zcmMvY29tcG9uZW50cy9Qb3VwV2l0aENvbmZpbWF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBwbGFjZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlc1wiKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGxhY2UtdGVtcGxhdGVcIik7XHJcblxyXG5leHBvcnQgY29uc3QgZWRpdEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX3R5cGVfZWRpdFwiKS5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xyXG5leHBvcnQgY29uc3QgYWRkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfdHlwZV9hZGRcIikucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcclxuXHJcbmV4cG9ydCBjb25zdCBlZGl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcclxuZXhwb3J0IGNvbnN0IGFkZEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcclxuXHJcbmV4cG9ydCBjb25zdCBwb3B1cElucHV0TmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2lucHV0X3R5cGVfbmFtZVwiKTtcclxuZXhwb3J0IGNvbnN0IHBvcHVwSW5wdXRQcm9mZXNzaW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW5wdXRfdHlwZV9wcm9mZXNzaW9uXCIpO1xyXG5cclxuZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25TZXR0aW5ncyA9IHtcclxuICAgIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pbnB1dFwiLFxyXG4gICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLnBvcHVwX19idXR0b25cIixcclxuICAgIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwicG9wdXBfX2J1dHRvbl9kaXNhYmxlZFwiLFxyXG4gICAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgICBlcnJvckNsYXNzOiBcInBvcHVwX19lcnJvcl92aXNpYmxlXCJcclxufTsiLCJjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybUVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gc2V0dGluZ3MuaW5wdXRTZWxlY3RvcjtcclxuICAgICAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yO1xyXG4gICAgICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzO1xyXG4gICAgICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcztcclxuICAgICAgICB0aGlzLl9lcnJvckNsYXNzID0gc2V0dGluZ3MuZXJyb3JDbGFzcztcclxuXHJcbiAgICAgICAgdGhpcy5fZm9ybSA9IGZvcm1FbGVtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIF9zaG93SW5wdXRFcnJvciA9IChpbnB1dEVsKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG4gICAgICAgIGVycm9yTWVzc2FnZS50ZXh0Q29udGVudCA9IGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2U7XHJcbiAgICAgICAgZXJyb3JNZXNzYWdlLmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgICAgICAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICB9XHJcblxyXG4gICAgX2hpZGVJbnB1dEVycm9yID0gKGlucHV0RWwpID0+IHtcclxuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XHJcbiAgICAgICAgZXJyb3JNZXNzYWdlLnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgICAgICBlcnJvck1lc3NhZ2UuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcclxuICAgICAgICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcclxuICAgIH1cclxuXHJcbiAgICBfaGFzT25seVZhbGlkSW5wdXRzID0gKCkgPT4gdGhpcy5faW5wdXRMaXN0LmV2ZXJ5KChpbnB1dEVsKSA9PiBpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcclxuXHJcblxyXG4gICAgX2NoZWNrSW5wdXRWYWxpZGl0eSA9IChpbnB1dEVsKSA9PiB7XHJcbiAgICAgICAgaWYgKGlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5faW5wdXRTZWxlY3RvcikpO1xyXG4gICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uKCk7XHJcbiAgICBcclxuICAgICAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xyXG4gICAgICAgICAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90b2dnbGVCdXR0b24oKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgX3RvZ2dsZUJ1dHRvbiA9ICgpID0+IHtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX2hhc09ubHlWYWxpZElucHV0cygpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXRGb3JtVmFsaWRhdGlvbiA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaChpbnB1dEVsID0+IHtcclxuICAgICAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbCk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZW5hYmxlVmFsaWRhdGlvbiA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG4gICAgXHJcbn1cclxuXHJcblxyXG5leHBvcnQgZGVmYXVsdCBGb3JtVmFsaWRhdG9yOyIsImNsYXNzIFBvcHVwIHtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl9oYW5kbGVFc2NVcCA9IHRoaXMuX2hhbmRsZUVzY1VwLmJpbmQodGhpcyk7XHJcbiAgICAgICAgdGhpcy5jbG9zZSA9IHRoaXMuY2xvc2UuYmluZCh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBfaGFuZGxlRXNjVXAoZSkge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Nsb3NlLWJ1dHRvblwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5jbG9zZSk7XHJcblxyXG4gICAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChbLi4uZS50YXJnZXQuY2xhc3NMaXN0XS5pbmNsdWRlcyhcInBvcHVwXCIpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgb3BlbigpIHtcclxuICAgICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5faGFuZGxlRXNjVXApO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLl9oYW5kbGVFc2NVcCk7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBQb3B1cDsiLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XHJcblxyXG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvciwgc3VibWl0SGFuZGxlciwgYnV0dG9uVGV4dCkge1xyXG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG5cclxuICAgICAgICB0aGlzLl9wb3B1cEZvcm0gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcclxuICAgICAgICB0aGlzLl9idXR0b24gPSB0aGlzLl9wb3B1cEZvcm0ucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fYnV0dG9uXCIpO1xyXG4gICAgICAgIHRoaXMuX2lucHV0TGlzdCA9IEFycmF5LmZyb20odGhpcy5fcG9wdXBGb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBfX2lucHV0XCIpKTtcclxuXHJcbiAgICAgICAgdGhpcy5fYnV0dG9uVGV4dCA9IGJ1dHRvblRleHQ7XHJcblxyXG4gICAgICAgIHRoaXMuX3N1Ym1pdEhhbmRsZXIgPSBzdWJtaXRIYW5kbGVyO1xyXG4gICAgfVxyXG5cclxuICAgIF9nZXRJbnB1dFZhbHVlcygpIHtcclxuICAgICAgICBjb25zdCBpbnB1dFZhbHVlcyA9IHt9O1xyXG4gICAgICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICAgICAgICBpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gaW5wdXRWYWx1ZXM7XHJcbiAgICB9XHJcblxyXG4gICAgY2xvc2UoKSB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBGb3JtLnJlc2V0KCk7XHJcblxyXG4gICAgICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd0xvYWRpbmcoKSB7XHJcbiAgICAgICAgdGhpcy5fYnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcclxuICAgIH1cclxuXHJcbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICB0aGlzLl9wb3B1cEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3N1Ym1pdEhhbmRsZXIodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUG9wdXBXaXRoRm9ybTsiLCIvLyBORUVEIFRPIFVQREFURS8vXHJcblxyXG5pbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5cclxuaW1wb3J0IHsgY2FyZFRlbXBsYXRlLCBlZGl0Rm9ybSwgYWRkRm9ybSwgZWRpdEJ0biwgYWRkQnRuLCBwb3B1cElucHV0TmFtZSwgcG9wdXBJbnB1dFByb2Zlc3Npb24sIHZhbGlkYXRpb25TZXR0aW5ncyB9IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcclxuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aENvbmZpcm1hdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3VwV2l0aENvbmZpbWF0aW9uLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xyXG5cclxubGV0IHVzZXJJZDtcclxuXHJcbi8vIEFQSVxyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgICBhdXRob3JpemF0aW9uOiBcIjQzOTU0NGIyLTMyNmUtNDAwMC1iZDdkLTdkOGVjOTNhZjcwNVwiLFxyXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgfSxcclxufSk7XHJcblxyXG5cclxuUHJvbWlzZS5hbGwoW2FwaS5nZXRJbml0aWFsQ2FyZHMoKSwgYXBpLmdldFVzZXJJbmZvKCldKVxyXG4gICAgLnRoZW4oKFtjYXJkcywgdXNlckRhdGFdKSA9PiB7XHJcbiAgICAgICAgdXNlcklkID0gdXNlckRhdGEuX2lkO1xyXG4gICAgICAgIHNlY3Rpb24ucmVuZGVyKGNhcmRzKTtcclxuXHJcbiAgICAgICAgdXNlckluZm8uc2V0VXNlckluZm8oeyBuYW1lOiB1c2VyRGF0YS5uYW1lLCBwcm9mZXNzaW9uOiB1c2VyRGF0YS5hYm91dCB9KVxyXG4gICAgfSlcclxuXHJcbi8vIEZ1bmN0aW9uc1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlQ2FyZChkYXRhKSB7XHJcbiAgICBjb25zdCBuZXdDYXJkID0gbmV3IENhcmQoe1xyXG4gICAgICAgIGRhdGEsXHJcbiAgICAgICAgaGFuZGxlQ2FyZENsaWNrLFxyXG4gICAgICAgIGhhbmRsZUxpa2VCdXR0b246IChpZCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpc0FscmVhZHlsaWtlZCA9IG5ld0NhcmQuaXNMaWtlZCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzQWxyZWFkeWxpa2VkKSB7XHJcbiAgICAgICAgICAgICAgICBhcGkuZGlzbGlrZUNhcmQoaWQpLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld0NhcmQuaGFuZGxlTGlrZUNhcmQocmVzLmxpa2VzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYXBpLmxpa2VDYXJkKGlkKS50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBuZXdDYXJkLmhhbmRsZUxpa2VDYXJkKHJlcy5saWtlcyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBoYW5kbGVEZWxldGVDYXJkOiAoaWQpID0+IHtcclxuICAgICAgICAgICAgY29uZmlybVBvcHVwLm9wZW4oKTtcclxuICAgICAgICAgICAgY29uZmlybVBvcHVwLnNldEFjdGlvbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhcGkucmVtb3ZlQ2FyZChpZCkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3Q2FyZC5yZW1vdmVDYXJkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlybVBvcHVwLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgIH0sIGNhcmRUZW1wbGF0ZSwgdXNlcklkKVxyXG5cclxuICAgIHJldHVybiBuZXdDYXJkLmdldEVsZW1lbnQoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQ2FyZENsaWNrIChuYW1lLCBsaW5rKSB7XHJcbiAgICBpbWFnZVBvcHVwLm9wZW4obmFtZSwgbGluayk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUFkZEZvcm1TdWJtaXQoKSB7XHJcbiAgICBjb25zdCBpbnB1dFZhbHVlcyA9IGFkZFBvcHVwLl9nZXRJbnB1dFZhbHVlcygpO1xyXG4gICAgY29uc3QgZGF0YSA9IHsgbmFtZTogaW5wdXRWYWx1ZXMudGl0bGUsIGxpbms6IGlucHV0VmFsdWVzLmxpbmsgfTtcclxuICAgIGFwaS5hZGRDYXJkKGRhdGEpLnRoZW4ocmVzID0+IHtcclxuICAgICAgICBjcmVhdGVDYXJkKHJlcyk7XHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVFZGl0Rm9ybVN1Ym1pdChkYXRhKSB7XHJcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyhkYXRhKVxyXG59XHJcblxyXG4vLyBDbGFzc2VzXHJcbmNvbnN0IHNlY3Rpb24gPSBuZXcgU2VjdGlvbih7XHJcbiAgICByZW5kZXJlcjogKGNhcmQpID0+IHtcclxuICAgICAgICBzZWN0aW9uLmFkZEl0ZW0oY3JlYXRlQ2FyZChjYXJkKSk7XHJcbiAgICB9XHJcbn0sIFwiLnBsYWNlc1wiKTtcclxuXHJcbmNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKHtcclxuICAgIG5hbWVTZWxlY3RvcjogXCIucHJvZmlsZV9fbmFtZVwiLFxyXG4gICAgcHJvZmVzc2lvblNlbGVjdG9yOiBcIi5wcm9maWxlX19wcm9mZXNzaW9uXCIsXHJcbiAgICBpbWFnZVNlbGVjdG9yOiBcIi5wcm9maWxlX19pbWFnZVwiXHJcbn0pO1xyXG5cclxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIi5wb3B1cF90eXBlX3ByZXZpZXdcIik7XHJcbmltYWdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmNvbnN0IGVkaXRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLnBvcHVwX3R5cGVfZWRpdFwiLCBoYW5kbGVFZGl0Rm9ybVN1Ym1pdCwgXCJTYXZlXCIpO1xyXG5cclxuZWRpdFBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5jb25zdCBhZGRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLnBvcHVwX3R5cGVfYWRkXCIsIGhhbmRsZUFkZEZvcm1TdWJtaXQsIFwiQ3JlYXRlXCIpO1xyXG5cclxuYWRkUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmNvbnN0IGNvbmZpcm1Qb3B1cCA9IG5ldyBQb3B1cFdpdGhDb25maXJtYXRpb24oXCIucG9wdXBfdHlwZV9jb25maXJtXCIpO1xyXG5cclxuY29uZmlybVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5jb25zdCBlZGl0Rm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHZhbGlkYXRpb25TZXR0aW5ncywgZWRpdEZvcm0pO1xyXG5jb25zdCBhZGRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IodmFsaWRhdGlvblNldHRpbmdzLCBhZGRGb3JtKTtcclxuXHJcbmVkaXRGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuYWRkRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG4vL0V2ZW50IExpc3RlbmVyc1xyXG5cclxuZWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgY29uc3QgZGF0YSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKClcclxuICAgIGVkaXRQb3B1cC5vcGVuKCk7XHJcbiAgICBwb3B1cElucHV0TmFtZS52YWx1ZSA9IGRhdGEubmFtZTtcclxuICAgIHBvcHVwSW5wdXRQcm9mZXNzaW9uLnZhbHVlID0gZGF0YS5wcm9mZXNzaW9uO1xyXG4gICAgZWRpdEZvcm1WYWxpZGF0b3IucmVzZXRGb3JtVmFsaWRhdGlvbigpO1xyXG59KTtcclxuXHJcblxyXG5hZGRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgIGFkZEZvcm1WYWxpZGF0b3IucmVzZXRGb3JtVmFsaWRhdGlvbigpO1xyXG4gICAgYWRkUG9wdXAub3BlbigpO1xyXG59KTsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG5cclxuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xyXG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XHJcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcclxuICB9XHJcblxyXG4gIF9jdXN0b21GZXRjaCA9ICh1cmwsIGhlYWRlcnMpID0+IHtcclxuICAgIHJldHVybiBmZXRjaCh1cmwsIGhlYWRlcnMpXHJcbiAgICAgIC50aGVuKChyZXMpID0+XHJcbiAgICAgICAgcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApXHJcbiAgICAgIClcclxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3I6ICR7ZXJyfWApO1xyXG4gICAgICB9KTtcclxuICB9O1xyXG5cclxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVVc2VySW1hZ2UoeyBhdmF0YXIgfSkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgYXZhdGFyXHJcbiAgICAgIH0pLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBhZGRDYXJkKHsgbmFtZSwgbGluayB9KSB7XHJcbiAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgIG5hbWUsXHJcbiAgICAgICAgIGxpbmsgXHJcbiAgICAgIH0pXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUNhcmQoY2FyZElEKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSUR9YCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBsaWtlQ2FyZChjYXJkSUQpIHtcclxuICAgIHJldHVybiB0aGlzLl9jdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJRH1gLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogJ1BVVCcsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGRpc2xpa2VDYXJkKGNhcmRJRCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElEfWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiAnREVMRVRFJyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn0iLCJjbGFzcyBDYXJkIHtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih7IGRhdGEsIGhhbmRsZUNhcmRDbGljaywgaGFuZGxlRGVsZXRlQ2FyZCwgaGFuZGxlTGlrZUJ1dHRvbiB9LCBjYXJkU2VsZWN0b3IsIHVzZXJJZCkge1xyXG4gICAgICAgIHRoaXMuX25hbWUgPSBkYXRhLm5hbWU7XHJcbiAgICAgICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcclxuXHJcbiAgICAgICAgdGhpcy5faWQgPSBkYXRhLl9pZDtcclxuICAgICAgICB0aGlzLl9saWtlcyA9IGRhdGEubGlrZXM7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrID0gaGFuZGxlQ2FyZENsaWNrO1xyXG4gICAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNhcmQgPSBoYW5kbGVEZWxldGVDYXJkO1xyXG4gICAgICAgIHRoaXMuX2hhbmRsZUxpa2VCdXR0b24gPSBoYW5kbGVMaWtlQnV0dG9uO1xyXG5cclxuICAgICAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XHJcbiAgICAgICAgdGhpcy5fdXNlcklkID0gdXNlcklkO1xyXG4gICAgICAgIHRoaXMuX293bmVySWQgPSBkYXRhLm93bmVyLl9pZDtcclxuICAgIH1cclxuXHJcbiAgICBpc0xpa2VkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9saWtlcy5zb21lKChwZXJzb24pID0+IHBlcnNvbi5faWQgPT09IHRoaXMuX3VzZXJJZCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGhhbmRsZUxpa2VDYXJkID0gKG5ld0xpa2VzKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fbGlrZXMgPSBuZXdMaWtlcztcclxuXHJcbiAgICAgICAgdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZV9fbGlrZS1jb3VudFwiKS50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlX19idXR0b25cIikuY2xhc3NMaXN0LnRvZ2dsZShcInBsYWNlX19idXR0b25fYWN0aXZlXCIpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZW1vdmVDYXJkID0gKCkgPT4gdGhpcy5fY2FyZEVsZW1lbnQucmVtb3ZlKCk7XHJcblxyXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzID0gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VfX2ltYWdlXCIpXHJcbiAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sodGhpcy5fbmFtZSwgdGhpcy5fbGluaykpO1xyXG5cclxuICAgICAgICB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlX19idXR0b25cIilcclxuICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX2hhbmRsZUxpa2VCdXR0b24odGhpcy5faWQpKTtcclxuXHJcbiAgICAgICAgdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZV9fdHJhc2hcIilcclxuICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX2hhbmRsZURlbGV0ZUNhcmQodGhpcy5faWQpKTtcclxuICAgIH1cclxuXHJcbiAgICBfZ2V0VGVtcGxhdGUgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NhcmRTZWxlY3RvclxyXG4gICAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19pdGVtXCIpXHJcbiAgICAgICAgLmNsb25lTm9kZSh0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRFbGVtZW50ID0gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2NhcmRFbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuICAgICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuICAgICAgICB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlX19pbWFnZVwiKVxyXG4gICAgICAgIC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKCR7dGhpcy5fbGlua30pYDtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlX190aXRsZVwiKS50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9vd25lcklkICE9PSB0aGlzLl91c2VySWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZV9fdHJhc2hcIikuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZV9fbGlrZS1jb3VudFwiKS50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaXNMaWtlZCgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlTGlrZUNhcmQodGhpcy5fbGlrZXMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NhcmRFbGVtZW50O1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgQ2FyZDsiLCJjbGFzcyBTZWN0aW9uIHtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih7IHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcclxuICAgICAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXIoaXRlbXMpIHtcclxuICAgICAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xyXG4gICAgICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZEl0ZW0oZWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgU2VjdGlvbjsiLCJjbGFzcyBVc2VySW5mbyB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoeyBuYW1lU2VsZWN0b3IsIHByb2Zlc3Npb25TZWxlY3RvciwgaW1hZ2VTZWxlY3RvciB9KSB7XHJcbiAgICAgICAgdGhpcy5fdXNlck5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fdXNlclByb2Zlc3Npb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHByb2Zlc3Npb25TZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fdXNlckltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihpbWFnZVNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRVc2VySW5mbygpIHtcclxuICAgICAgICByZXR1cm4geyBcclxuICAgICAgICAgICAgbmFtZTogdGhpcy5fdXNlck5hbWUudGV4dENvbnRlbnQsXHJcbiAgICAgICAgICAgIHByb2Zlc3Npb246IHRoaXMuX3VzZXJQcm9mZXNzaW9uLnRleHRDb250ZW50IFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VXNlckluZm8oeyBuYW1lLCBwcm9mZXNzaW9uIH0pIHtcclxuICAgICAgICB0aGlzLl91c2VyTmFtZS50ZXh0Q29udGVudCA9IG5hbWVcclxuICAgICAgICB0aGlzLl91c2VyUHJvZmVzc2lvbi50ZXh0Q29udGVudCA9IHByb2Zlc3Npb25cclxuICAgIH1cclxuXHJcbiAgICBzZXRVc2VySW1hZ2UodXJsKSB7XHJcbiAgICAgICAgdGhpcy5fdXNlckltYWdlLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGB1cmwoXCIke3VybH1cIilgO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgVXNlckluZm87IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5jbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcclxuXHJcbiAgICBvcGVuKG5hbWUsIGxpbmspIHtcclxuICAgICAgICB0aGlzLl90aXRsZSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWFnZS1uYW1lXCIpO1xyXG4gICAgICAgIHRoaXMuX2ltYWdlID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltYWdlLXByZXZpZXdcIik7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5fdGl0bGUudGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuX2ltYWdlLnNyYyA9IGxpbms7XHJcbiAgICAgICAgdGhpcy5faW1hZ2UuYWx0ID0gYEltYWdlIG9mICR7bmFtZX1gXHJcbiAgICAgICAgc3VwZXIub3BlbigpO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUG9wdXBXaXRoSW1hZ2U7IiwiLy8gTkVFRCBUTyBVUERBVEUvL1xyXG5cclxuaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5jbGFzcyBQb3B1cFdpdGhDb25maXJtYXRpb24gZXh0ZW5kcyBQb3B1cCB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHNldEFjdGlvbihhY3Rpb24pIHtcclxuICAgICAgICB0aGlzLl9zdWJtaXRIYW5kbGVyID0gYWN0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdGhpcy5fc3VibWl0SGFuZGxlcigpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFBvcHVwV2l0aENvbmZpcm1hdGlvbjsiXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY2FyZFRlbXBsYXRlIiwiZWRpdEZvcm0iLCJhZGRGb3JtIiwiZWRpdEJ0biIsImFkZEJ0biIsInBvcHVwSW5wdXROYW1lIiwicG9wdXBJbnB1dFByb2Zlc3Npb24iLCJ2YWxpZGF0aW9uU2V0dGluZ3MiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImNvbnN0cnVjdG9yIiwic2V0dGluZ3MiLCJmb3JtRWxlbWVudCIsImlucHV0RWwiLCJlcnJvck1lc3NhZ2UiLCJ0aGlzIiwiX2Zvcm0iLCJpZCIsInRleHRDb250ZW50IiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJjbGFzc0xpc3QiLCJhZGQiLCJfZXJyb3JDbGFzcyIsIl9pbnB1dEVycm9yQ2xhc3MiLCJyZW1vdmUiLCJfaW5wdXRMaXN0IiwiZXZlcnkiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hpZGVJbnB1dEVycm9yIiwiX3Nob3dJbnB1dEVycm9yIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsIl9pbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvbiIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsIl90b2dnbGVCdXR0b24iLCJmb3JFYWNoIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJfaGFzT25seVZhbGlkSW5wdXRzIiwiZGlzYWJsZWQiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsIl9zZXRFdmVudExpc3RlbmVycyIsInBvcHVwU2VsZWN0b3IiLCJfcG9wdXBFbGVtZW50IiwiX2hhbmRsZUVzY1VwIiwiYmluZCIsImNsb3NlIiwiZSIsInByZXZlbnREZWZhdWx0Iiwia2V5Iiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJ0YXJnZXQiLCJpbmNsdWRlcyIsIm9wZW4iLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiUG9wdXAiLCJzdWJtaXRIYW5kbGVyIiwiYnV0dG9uVGV4dCIsInN1cGVyIiwiX3BvcHVwRm9ybSIsIl9idXR0b24iLCJfYnV0dG9uVGV4dCIsIl9zdWJtaXRIYW5kbGVyIiwiX2dldElucHV0VmFsdWVzIiwiaW5wdXRWYWx1ZXMiLCJpbnB1dCIsIm5hbWUiLCJ2YWx1ZSIsInJlc2V0Iiwic2hvd0xvYWRpbmciLCJ1c2VySWQiLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsInVybCIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0SW5pdGlhbENhcmRzIiwiX2N1c3RvbUZldGNoIiwiZ2V0VXNlckluZm8iLCJ1cGRhdGVVc2VySW1hZ2UiLCJhdmF0YXIiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFkZENhcmQiLCJsaW5rIiwicmVtb3ZlQ2FyZCIsImNhcmRJRCIsImxpa2VDYXJkIiwiZGlzbGlrZUNhcmQiLCJhdXRob3JpemF0aW9uIiwiY3JlYXRlQ2FyZCIsImRhdGEiLCJuZXdDYXJkIiwiY2FyZFNlbGVjdG9yIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlRGVsZXRlQ2FyZCIsImhhbmRsZUxpa2VCdXR0b24iLCJuZXdMaWtlcyIsIl9saWtlcyIsIl9jYXJkRWxlbWVudCIsImxlbmd0aCIsInRvZ2dsZSIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfbmFtZSIsIl9saW5rIiwiX2hhbmRsZUxpa2VCdXR0b24iLCJfaWQiLCJfaGFuZGxlRGVsZXRlQ2FyZCIsIl9jYXJkU2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX2dldFRlbXBsYXRlIiwic3R5bGUiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJfb3duZXJJZCIsIl91c2VySWQiLCJkaXNwbGF5IiwiaXNMaWtlZCIsImhhbmRsZUxpa2VDYXJkIiwibGlrZXMiLCJvd25lciIsInNvbWUiLCJwZXJzb24iLCJjb25maXJtUG9wdXAiLCJzZXRBY3Rpb24iLCJnZXRFbGVtZW50IiwiaW1hZ2VQb3B1cCIsImFsbCIsImNhcmRzIiwidXNlckRhdGEiLCJzZWN0aW9uIiwicmVuZGVyIiwidXNlckluZm8iLCJzZXRVc2VySW5mbyIsInByb2Zlc3Npb24iLCJhYm91dCIsImNvbnRhaW5lclNlbGVjdG9yIiwicmVuZGVyZXIiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwiaXRlbXMiLCJfaXRlbXMiLCJpdGVtIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJwcmVwZW5kIiwiY2FyZCIsIm5hbWVTZWxlY3RvciIsInByb2Zlc3Npb25TZWxlY3RvciIsImltYWdlU2VsZWN0b3IiLCJfdXNlck5hbWUiLCJfdXNlclByb2Zlc3Npb24iLCJfdXNlckltYWdlIiwic2V0VXNlckltYWdlIiwiX3RpdGxlIiwiX2ltYWdlIiwic3JjIiwiYWx0IiwiZWRpdFBvcHVwIiwiUG9wdXBXaXRoRm9ybSIsImFkZFBvcHVwIiwidGl0bGUiLCJhY3Rpb24iLCJlZGl0Rm9ybVZhbGlkYXRvciIsIkZvcm1WYWxpZGF0b3IiLCJhZGRGb3JtVmFsaWRhdG9yIiwiZW5hYmxlVmFsaWRhdGlvbiIsInJlc2V0Rm9ybVZhbGlkYXRpb24iXSwic291cmNlUm9vdCI6IiJ9